import math
import numpy as np

# -------------------------
# Utility: convert predicted return -> weight (same as RL)
# -------------------------
def to_weight_from_rhat(r_hat, sigma_est, k=1.0, max_abs_weight=1.0):
    # r_hat: scalar or array; sigma_est: same shape (volatility estimate)
    raw = (k * np.array(r_hat)) / (np.array(sigma_est) + 1e-8)
    w = np.clip(raw, -max_abs_weight, max_abs_weight)
    return w
